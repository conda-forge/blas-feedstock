From db92adeb99a3e2e4c652028c138b47d13b796c80 Mon Sep 17 00:00:00 2001
From: "H. Vetinari" <h.vetinari@gmx.com>
Date: Fri, 14 Feb 2025 15:13:15 +1100
Subject: [PATCH 5/6] add routine to initialize xerbla for usage with mkl

---
 TESTING/EIG/CMakeLists.txt | 1 +
 TESTING/mkl_init.f         | 7 +++++++
 2 files changed, 8 insertions(+)
 create mode 100644 TESTING/mkl_init.f

diff --git a/TESTING/EIG/CMakeLists.txt b/TESTING/EIG/CMakeLists.txt
index 20fd25b4a..b5914b2a1 100644
--- a/TESTING/EIG/CMakeLists.txt
+++ b/TESTING/EIG/CMakeLists.txt
@@ -19,6 +19,7 @@ set(AEIGTST
    alareq.f
    ilaenv.f
    xerbla.f
+   ../mkl_init.f
    xlaenv.f
    chkxer.f)
 
diff --git a/TESTING/mkl_init.f b/TESTING/mkl_init.f
new file mode 100644
index 000000000..63c10fc8b
--- /dev/null
+++ b/TESTING/mkl_init.f
@@ -0,0 +1,7 @@
+subroutine MKL_INIT_XERBLA()
+    INCLUDE 'mkl.fi'
+    EXTERNAL XERBLA, mkl_set_xerbla
+
+    ! Register the custom error handler
+    call mkl_set_xerbla(XERBLA)
+end subroutine MKL_INIT_XERBLA
